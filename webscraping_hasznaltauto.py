import requests
from bs4 import BeautifulSoup
import re
import xlsxwriter

T=[["https://www.hasznaltauto.hu/talalatilista/PCOHKVGRR3RDADH4S56ACFEWHXBOHHOQVV2EEK45WSXZK2KNBFGWFFFE2XBGV775TS3EAU3RJ62WNYTYHSYQW4RZS5PV5TRTFFVAQWERKOYMGVTMDCNUXYNPNBIF7IAJ2RAUWKKAU4DXOA36KSXMJAF6QUJPYVLM6ZZDMXGSGKWMDZKG3F4MSTAKGFS6A46MXREIDDOLSO6N2MZCU3O6W42VBM5OIJ3QU3U65ELC3Z6V7JNIYCAS2FDI4WPRZSDCU6QMSPXBXDTB4HPKEMDHUQVPUVQH3ZCVYAIPEW4ZVEW3JBKTQDJQ3Z2GB7OACG7VK3JIBTPP3CUOCMLYNOLLW4PIDMOXYFFQMAQ3GWJH4XD7IEL6PJ3XQOGHA36SNA372G22UQE7HD3X5PBYWIP2VRCBJ3DJLC6GA4ZH7FAP56HAYBKF62W6Z2KVS727DNQ3XSMN3PCQP3V7UHDFVOW5EAO54PBLFSELEO4IVKN4EBV3CCBUULQ76NFXM3ANLEFLGJLGFUKZWZNMOMH2J4SWUPKQ3RUPN4V2L2FD4K5IOPRU7KBHQODS3PZEQTKOSOZYOK5FMLN7VQPA54M4DR4BKQVIZV2JUEZKDFTVNWHQDKA32QDVX4L3JBRTAWYQCVX4UX5F32LGJLEXSH3HGHHPU6AR4NCR6L3DXTWOGF5R7HTIBB7ARC3EFV5YGAKZM4XJUJC5GT4B5KOKPX6AUPEUNI6HATSSNWCFRXTEU5IUZWT34OUD4OX4CQEA6EQPAYPS7ZNPHWWUMN6BLZ4DB3VDHGI2IZIWGHPCRT4RZ5Q2SKSFQQZXXQCVMTPAQDTBY2ZHW522WHCH7RNJHPNUMOHJ2QD7TYEG3SOSSEOFKY74WX7TL4JOR5IR5LK2FOJ3IGX7FVOA33IFPV7CAV4BGYRZ3X55ZG6CXP5INAGNVEOY5575DXV2EU","Tesla 3"],
   ["https://www.hasznaltauto.hu/talalatilista/PCOHKVGRN3NTADH4C56UD3FG5WVDY3RIKZQAQCQM5CV4DWUMUNMBEA2JG2NAJ6PXKF3JESSG6ZSOETQUR4T5EIEXQU6HSWMUKJ2BBMBFU5QI3A2YGFLERYMPNBIB7IAPGRBEWKKA44D5OF34VNOIGAP5AAG7RI2YPXFMLZMSQFQQ3LRSZLDEWFSSRA4QGXZJ6MUAL5VOZLZNN54ITB3KXT2VFXUFB3OATF7LYR4KML6D4S6RQIBVWK6QZLPTSUGGJZAZHPODOHGU65FIW4MOQDX5EIC6WI5PAKDFAXOLZRW2CV6YAXMF24LOOTBR3MCRN4GV3MHCQYSQ3J7AWVM65RVB5527AUOAAMFVSLCGFE76ND7Q2O543N3TNTIG6MXYC7O2A2XUTFZ67W4DEP52CGV4ZAU3S4W57NAOND7S4HOZDINAZC7DKE75GRTH3PFNF5PCZLS6FD76VJQ4MXNVPJIDXLXQXG52VK36AWVGVKNKZRJ2KBBMH73JN3GYB25AKJG2ZRFCZPZOSJMG2F7WUUHLQQVCNCUTQLNPO7UHPI3HOOHQINBMRDN6QGE5DHI27BQ7LZIQR7EYMNZBQTHMZBZZUOZGSZUBHVXRDWADWS3XWQLL3BJRAK4QR7ZKJJSVDFDUVSLCRLFRRF2T7QIOHBZJL3DHQOOFR5RHLZUAM5QIXNSF265TAF4WOP4Z4ROPO6A3VCUH37AHPE55I2HRTSSNWCFRVTMRXIUJUT45I2B6HH6BICAHIDXYGB4X73DYNO5BI74K4NARX5MVBUG2HKFRBNY4I7AFT4NLFJCYIP33YBCWZXQIAZQ7NNT3PDM3DQT7ZWERHUGCTR2OUDP47BAOMRUUXDW2CR7Z57SMXTFCTSRL2RUWLMSW4OXYLK5BHWQK6NXELLICNULZTZGOMVPZIV2W7UBGMLH76ACLOO46W","Tesla S"],
   ["https://www.hasznaltauto.hu/talalatilista/PCOHKVG3R3NDAEH5C57QDYNS3ONMOVVIJAKVVKOSXZDLHSIQJRWA7MU5NAA63P3XTQCIQI7WFGRXHZT2HQJZBS2ML264ZZSS2QILAIVHMCD22WBTSZE6CL3IKCP2CCOUIFFSSQFHR25QCPZIK5REBX2CBH7CFVQ7OI3CI2IZ23QHFI3MJQZJGQSMDH4BYMZLFGYHC6ISW55UNRFQPN6242SBQ76ARTRULUPCTMXO7MVEKBIONSQUAK77YRQR4JYFJX3ATRZVH7IKCPTAUAT7ITZJXA77EKTABD423TCUC3NMAMOA6GDPHID3T2AILWUWGRQNSHI3BU6AM36D6I2A47NDQOHQ2LFYSHM2Y27FY72BC7TZW57SRRYC7UQYH76QWWVEBHZI653DQO5S56VMJIM5HFLS4GQ7ZD6FKPV4HEZBIFGZNXM5GL252T5XMN3IGG5WTIP4Y32TDSSWDOSQHOSHYKZMRCYDXCFKTPBANOYQQNFC4F5ZURZT4BVMQVIZFPYXWZPTNBCPLKKEVUD2EU5DMM4CFKCT4OH2QJ2LQ4W36IUEKTSTWOCSXFLC3P5KD2OLRZU6Z4QIJWSMG442DESV437BUPRBWBT2R3TZIFVTQUIQNOICW6KV7WOXJ65EMTLNX43IZ55XWEPNIVXS7I555TWZKWD7WHASGH6QK3UBUF5GRWSVY6TEKHYGHIB247GTP4AYWLI6QMKBPEEFMUNDXFIB3G3GV5VSO4H4FUMAQMC6AJ3CN3ZPGWPUYPOGL7RG5UC6PUTBXQZINKWEHXBPT7BYPBREFDLNADK7QBKRGOFAHHC5USNW52GOG6S7NKZOO5WMWEJOQT4TIZN3E5BAI7KRQ77NP5FXZR3DSTX2PVWKESR4N7YKK5BXWRU757EVLIGNVDH26XTEX2J56VBUA3W2RWNP76ZGPOJZ","Audi A4"],
   ["https://www.hasznaltauto.hu/talalatilista/PCOHKVG3N3NTADH5C56UDEVGG7SXCQ5RAJBVAYGALYG5MZQ4YWJBQSFU2GSORP4PWKO5IMVSE4J6P4D2IQNPI6VJH6RV5LVUNKALDJTAMCFZ3WQIW3KCVHWRUE6UDS6UINV23QHGR3NRDX43KAQWH3FAQJ4FNG3XXUMJG5ACLMEIKMZ6EVMWRJPGBR6EZGL3VWYA2RIWW66ULJFQNN62T2WBOJYYBYG2H2HVNS767OUFKDIBPRU4BGTYYNQZKJQFJP7AMJZV34Y2BXJD2MG7UWJL5GH2EYLEFYXGLZVS2AFRYGAOC5OANXOJAQRNI22FEO3LYYUTQGT6AZKYTETGA3BNY7KMBHJUWJMPJLJ4ZUP6CRYMXNX6KRFAL7SPAD4GZ2KBQM7F333KOQH6V6UXA3DHEWK4WNRSXHPSN4S3EBDWZSF7KYB73UCH7V653DS2FQXFVGHYCKDBRY7LC5RRTQ3XYKVCZSR5QRNKRIRE56YWJGWQ6B7VURTTCANCQTEVFLEXWPJ5EYR2STYVLI5RFIWG6PBZGGRC3AONW6CAHNNTV3HECWAXHFNP4BCOLRTU6KVHM5ESTI5TSA7GY3GTOONDWJKZN7S2HEQ7AJ5IV544CWRYCKVQ32D37VUYMO7J67E6RZLAV6JL2GXMXNSN6DPWHLM6XQN6K6NS6MLE4Q67UGSDDN4N4WGO4VDZMBB7GA2YK3F6QPXSCW4LCEZVJBQQCUW3UMZVVFU7D6XMAVHL6BIHBTJSKEDHRLY5ZSGJGRJ7YIPNA3W4YR5WGGBKFRMG2N7MKAW6FVSEDKMGNXSQFPEZYGGO5GDKM7M7UM2O5N6W5SE7XIUSOSTAHTHBV3OI2OPAFVKT7RY7QLOJDVHVDOM7YYNJPDM27YVVEDP5BFR3DI2QQN2ZGPV7A2I6KTT6KLMTV5ETM2774AIIJO4VS","Mercedes C"],
   ["https://www.hasznaltauto.hu/talalatilista/PCOHKVG3R3RDADH5S56ADZJSWMNR454FCZUYKRS2NFPCWT3LJJUBFIZEVUDNB7H3HJWYDJTCTZVJ2E6HHYTXMQJOGN47KMU3JNIUHQEKTSBB3NTCZVMCNBN7UBAX3BRGKADS3JIATUPNYDPYIG4REA72CZFPAF5R72ILHYMSSZQQ2LRXZLDEWZSSRAUQHH3DMYSQKNROJ7ZHNT4ITB3K7T2VFXUJAH6BTGTLWR4KVT534SSRQEBVWKGQZI7TSMEPJJAZG7OCOHGQ65FIB4MOQCP5KMFO5D54BIMEE7RLGO2YKNTQBRYLZYJMOTHQVWFINVEQHFW5WGI6AMLYCPFWUHH2IYDR6G2YOAR3GWOXZKH6SI746JXP64EOBX5EGBX7UFVVLAJ6OHXO24DWMTPVLCKDHNZ24XBUH2IPTK34PBZWIKBIWLN3FJ27XKWPP3LO6BRHN42C7GG6W44UVU3EUB3UR4F4WIRPB3QCVJXSQKWMKIWQRCDO62MWM3ANLEFLGIKR33NHCK2R4GEWSNS4XJPIOOBDUNP6RB5DE5WY6I5UESD5X2BSHH3L2XZLX2XBCBH4THQXEGCNUTDHHGQZEYPGAYNV4IVQM6UO554C2ZYKEIGWEBL7FKX2JXUSMSWJVSH6OMM667YSFRULHZPMM6GZY4V3D7XCQDOTRIFN2A2S4TA3JO4XJTNC4XDUA5OOWNX6AINS2HUDCQKZAS52RUK4VCHE345JNNTXB7BRDAEDAHQDHZGN4X3KL2NHVDF7YTU2BPP2JRTIMUOULCDTQYJ6Q4HQ2SKSVSQRXXQBVMTHAQDTRK2ZHW52IWHAG7VJZGPNWMOHJ2QD6TI2NXE5FAI4KVR7ZNP7GHYSND2R32QFUK4TJCGX6FVOQ33IYPW7SOVUBG2RT5P33SN4FG72S2AM3JI3GX77AGMPRONA","Opel Corsa"],
   ["https://www.hasznaltauto.hu/talalatilista/PCOHKVG3R3RDADH5S56ACZLAF3QXCV3II5NKDEKWTLL4VNFGQQTDCSWSNJQMJP5P2MLGQKXGVHLDS4PMONRBPZBCSPPV4ZTTFFVAQWERKOYMCVVMDDF2J4DHGSUE7UAE5KQIKFFA2OBZWAO7FNLWEQG7IIE74LCWLM4RWLTJDHLOA4VDNS6GIJUFTAZPANLGSZJGBY7SERX7HCEING37UXGVQIHPSAM4NG5HXJGIXLXYWFAVHCYIKAVN7SBQH45ICQ2NSBY427OKEQ55Y5AA72BXFG4D74RKMAEPTNOM2QLFVQZBYDQYVM6QDUVWBI66JMNLB3EGRUCI7QNLLBLOHUBXHL4NRQATG4ZJW5NNXRHB7YMXO653W43M2APTF6APLWVQV5EJOMP7XEZD7OUUUHG2TFZ6LIXRQHGF7ZODQ4RUGQMRPUXXX6VZZP5HZXYML3GK4XRIX53H3DVS2VNOTAHOPZQVTZGFDZOMKVC6SC2VQBA22HYDHTOSBS4BU4SV3ZCL7RJI3JHSK2R5GAWCPG57X2ED4J5IMPRQ7KBHMODS3PZDQTKOOGZY6K4VMLN7VMPA54MU5R4BCQVIZV2JMEZKDFTG5MHBEUBHXAXKOYXWQDKHBJRAK4RJX5K36KO5IQUZT5PRHTDPGPT6RLYVGHZPMK6ORY5FLBOTQYBX6ZUCW5ENBPJ4MUROLWZWR6JBKCO7H3A3XCFWYND2JRIBNQJONI2GPKTD2N6OVOZTHD7BQDAEDCHQCHZG57HTKL2NHXDJ7Y3U2BHH2JJTYMUGVLCDTQYJ7Q2WIOJBI27IQZ34BKQJDTIBYY7N4S3G5EPDQCPWXMVHO3GLCE7IR6JUMW5SWQTUPVIYP7UX6TF4ZFRZIN5I23FCIUXDT6C2XIJ5UHHXPZBK2BTNJZ5FG6MTPZJXCWGUCO3K63ZB7RWVXGYQ","Porsche Cayenne"],
   ["https://www.hasznaltauto.hu/talalatilista/PCOHKVGRR3RDADH4S56ACBLWXEGY65223VFCPNGSJH5VVGOWSTICIRSJLIWSB7X5TS3EAU3RJ62WNYTYHSYQW4UZZGFZPWK4RINAEVXECRWLAFLLYYZCT7AZBXVBGNEBHJUCSBPI6TQGNQHXZKKRRUFXKCBD7C7VK3HIMS22QY23RXBIDMXZSSJBUYGHZD4ZC4U3A4LZSK3XSRWEWR5X3LTKIGD7YAGOGTOT2UTE3V3SKRIFBZWKCQBL77SMAPDWBKNOYE4ONNXNDIO6MOQCP5E3CSWI7PAKDBBH4KZTWWC55YIQ4BYMHOORDV34ART5SQ2GBWI5DM2TYBTPZVZDODT5UOBY6AQWFRSDN25E7SMD5QSP553A7Z6YUDPWJ4BPXJLBL2AT447POJ2H6ZFZKOGITFZ6LIXRQHGB7ZODU4RUGQMR7UUHX6VVZP5PVWAML3GG4XRI77XPUHDFVN32KA52Y6CWLEIXPNYBKU3ZIHLGEELIITB762LOZWAKWIKX4W66TNYYIX52SRFNA6DNXSPGVNHA5ZYEOVWPYAPVMTWLBZLXQSIPU7AHI47NPKXFO7K4GIM6SIOS6QQIWWM444SCEXB4YAQ3LYRLAJ5I533YFVTQUQQNMIC74RC7LG6SJWKJEWI7Z5RTZ37DIWGBO7N4RTY3FD27YT5MUAN3WFDVXILLLSMAUS5ZOTG2FZMHIB245M3P4DIWJI6RMOBHEE7MUJDHHJR2RLTFHF6O4D4GGMAQMA6AM7EYXQ75PPBU6UMH7DOTIE57LHOMBSR2RMIOOHBHYDS3BVEVFLFBDPPADKZGOBAHHDFVSPN3URMOAN7K5SM63IY4OTVAH5HIJNTENFHY5KRRX3VH6TF4ZFRZIN5I23FCJLOGH4FVOQ33IKP67SCVUDGURZ5VG6MTPZIXCWGUCOYSPP6QPMNUXGUQ","Porsche 911"],
   ["https://www.hasznaltauto.hu/talalatilista/PCOHKVG3R3RDADH5S56ADZJSWMJR454FCZUYKRS2NFPCWT3LJJUBFIZEVUDNB7H3HJWYDJTCT5VJ2E6HHYTXMQJOGN47KMU3JNIUHQEKTSBB3NTCZVMCNBN7UBAX3BRGKADS3JIATUPNYDPYIG4REA72CZFPAF5R72KLHYMSSZQQ2LRXZLDEWZSSRAUQGX3DMYSQKNROJ7ZHNT4ITB3K7T2VFXUJAH6BTGTLWR4KVT534SSRQEBVWKGQZI7TSMEPJJAZG7OCOHGU65FIB4MOQCP5EYC7OR26AUGCDP4VTHNEEGZYAY4N44AWXJTQK3GUW2SADS7O3BEPAGF4RFSTKDT5UOBY6DJMXCI5TLDL4XD7IEL6PK3X6OGHA36SNA372G22UQE7HD3X4OB3WIP2VRFBTU4VOLQ2D7EPYUJ6XQ5TEFAU3FW5TUZPLXLMO5RXPAY3W6NB7TDPKOOKKYN2KA52Y6CWLEIXA5YBKU3ZIHLGEELIITB762MWM3ANLEFL6ITDUW6GFDNE6JLKHUYCYJ23ZTPEJHYT2SU7CR6USOY4HFW7CFBOV4Y5DT4VZK4W35KQ7B3YJL3LYCBB2RTDVSYJSUGDGN6Y6AJICPKDOW7RPNEGCMC3CBVZSJL5K32KG5IUUZT5HSH7DPEPC4YV55HRGLDMWPS6RH2TOB7MYYAW3BNOOFQ5UWGKUVVRMLJ7A2VHHHT5AMHZDDKGR4E4UIWYIWG6MQTVNSNE6XJ3QPRY7QKAQDYRR4DB6L7FF46S2RR7YJKOA7W5KVZSGOGKFRR2YQE7GOL4NJEJEYQN3XYA4WBVQEBZUU5MTXONMLLSDTYEWTPW3SHDS5QC7VU5E2CLSYHOJKA24OX73D4JG54YZ4QG2VNJSRDK7SZXANNUM72PTHS4AXNIZ6X45ZG6MTPZIVCWHUEOTL674B5OUC42Q","Renault Clio"],
   ["https://www.hasznaltauto.hu/talalatilista/PCOHKVGRN3RDAEH4C57QDIKALPZXRJ7KFKOVBJMT7INC3SISJRWC7MU5VBIPD35XJYBMIEL5ZJVMN265DHXQNZBCSPPV4ZTTFFVAQWERKOYMCVVMDHF2J4DHGSUE7UAE5KQIKFFA2OBZWAO7FNLWEQG7IIE74LGWLM4RWLTJDHLOA4VDNS6GIJUFTAZPANLGSZJGBY7SERX7HCEING37UXGVQIHPSAM4NG5HXJGIXLX3GFAVHCYIKAVN7SBQH45ICQ2NSBY427OKEQ55Y5AA72CXFG4D74RKMAEPTNOM2QLHVA2DQDBRKZ5BHNLMARV5S42GBWINDMER5A2XWGWMNILPOTYLDAJHNZSDN222PGMT5QRP553HPZ6YUA7WJ4A7XJLBL2AT447PMJ2H6ZJZKOFUGPT4URPDAOM37SUHB5DYNARC7NPPN5FKZP5HZXYML3GK4XRI77TPUHDFVM32KA527OCWLEIXPNYBKU3ZIHLGEELIITB46NCLGPQGVSCVPEK32WGFFDNE6JLKHUYCYJ23XW6IUPRHVBR6GD5IE5RYOLN7EOCNJZY3HDZLSVRNX6VR4DXRSTWHQEKCVDGXJFQTFIMWM3VQ4ESQE64C5J3C62ANI4FGEDLSFG7VLPZJ3VCCTGPV6E6MN4Z6P2FPCUY7F5RLZ2HDUVMF6ODAG73GQK3URUF5HRSSFZO3G2HZEFIJ347MDO4IW3BUPJGFAFWBFZVDIZ5KMPJXZ2V3GM4P4GAMAQMI6AI7E3X46NJPJU64MV3RHJUKPPUSTFQRINOWEFHJRT3BVMQUTCRVOTBTWYGVAQHGRDVROZZFXN6IOHAM6NOZKM56NWAJ6TDUTIZNLHNJHI3KRQ77OPZG33SDDSQ3KRVWKEVJ6HH4FVOQT3IOOO3SCVUDH2XT2KN4ZG7STOFMNIA5GV57SD6ZPC43Q","Volswagen Polo"]]

for x in T:
    link=x[0]
    cartype=x[1]
    url = link+"/page1"
    print(url)

    response = requests.get(url)

    soup = BeautifulSoup(response.text, 'html.parser')
    print(soup.title.text)

    workbook = xlsxwriter.Workbook(re.sub(r'$', '.xlsx', cartype))
    worksheet = workbook.add_worksheet('Alap adatok')
    worksheet.write(0, 0, 'Index')
    worksheet.write(0, 1, 'Név')
    worksheet.write(0, 2, 'Ár (Ft)')
    worksheet.write(0, 3, 'Üzemanyag típus')
    worksheet.write(0, 4, 'Évjárat')
    worksheet.write(0, 5, 'Űrtartalom (cm³)')
    worksheet.write(0, 6, 'Teljesítmény (kW)')
    worksheet.write(0, 7, 'Lóerő (LE)')
    worksheet.write(0, 8, 'Km óra állása (Km)')

    sor = 0
    oldalszam = 1
    kereses = True
    while kereses:
        regex = re.compile('row talalati-sor*')
        cars = soup.find_all('div', class_ = regex)
        oldaldarab = 0
        
        for car in cars:
            regexprice = re.compile('pricefield-primary*')
            name = car.find('h3').text
            price = car.find('div',  class_ = regexprice).text.replace('\xa0','').strip(' Ft')
            fuel_type = car.find('span', class_ = 'info').text.strip(',')
            year = car.find('span', class_ = 'info').find_next("span").text.replace('\xa0','')
            terfogat = car.find('span', class_ = 'info').find_next("span").find_next("span").text.replace('\xa0','').strip(' cm³,')
            torque = car.find('span', class_ = 'info').find_next("span").find_next("span").find_next("span").text.replace('\xa0','').strip(' kW,')
            hp = car.find('span', class_ = 'info').find_next("span").find_next("span").find_next("span").find_next("span").text.replace('\xa0','').strip(' LE,')
            while True:
                try:
                    # Eredeti lekérdezés
                    km = car.find('abbr').text.replace('\xa0','').strip(' km')
                    break  # Ha sikerült a lekérdezés, kilépünk a while ciklusból

                except Exception as e:
                    print("Hiba történt:", e)
                    # Alternatív lekérdezés
                    km = car.find('span', class_ = 'info').find_next("span").find_next("span").find_next("span").find_next("span").find_next("span").text.replace('\xa0','').strip(' km')
                    break
                
            worksheet.write(sor+1, 0, sor+1)
            worksheet.write(sor+1, 1, name)
            worksheet.write(sor+1, 2, price)
            worksheet.write(sor+1, 3, fuel_type)
            worksheet.write(sor+1, 4, (year[0:4]))
            worksheet.write(sor+1, 5, terfogat)
            worksheet.write(sor+1, 6, torque)
            worksheet.write(sor+1, 7, hp)
            worksheet.write(sor+1, 8, km)
            sor+=1
            oldaldarab+=1


        if oldaldarab == 0:
            kereses = False
        else:
            oldalszam+=1
        # Regex pattern az oldalszám keresésére
        pattern = r"(\/page)\d+"
        # Az új link generálása
        newurl = re.sub(pattern, r"\g<1>" + str(oldalszam), url)
        print(f'VÉGE AZ OLDALNAK! KÖVETKEZIK: {oldalszam}')
        response = requests.get(newurl)
        soup = BeautifulSoup(response.text, 'html.parser')
        print(newurl)
        print(oldaldarab)  
    workbook.close()    
    print(sor)
